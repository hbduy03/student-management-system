{% extends 'Home/base.html' %}
{% load static %}
{% block body %}

<div class="page-wrapper">
<div class="content container-fluid">

<div class="page-header">
<div class="row align-items-center">
<div class="col">
    <h2>Chatbot AI của bạn</h2>
    <div id="chatbox" style="border:1px solid #ccc; height:300px; overflow-y:auto; padding:10px;">
        <!-- Tin nhắn sẽ hiển thị ở đây -->
    </div>
    <input type="text" id="message" placeholder="Nhập câu hỏi..." style="width:80%;">
    <button id="sendMessage">Gửi</button>
</div>
</div>
</div>
</div>
</div>

<script>
    function sendMessage() {
        const messageInput = document.getElementById("message");
        const message = messageInput.value.trim();
        if (!message) return;

        const chatbox = document.getElementById("chatbox");
        chatbox.innerHTML += `<p><b>Bạn:</b> ${message}</p>`;
        chatbox.scrollTop = chatbox.scrollHeight;

        fetch("/api/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        })
        .then(res => res.json())
        .then(data => {
            if (data.reply) {
                chatbox.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
            } else {
                chatbox.innerHTML += `<p style="color:red;"><b>Lỗi:</b> ${data.error || "Có lỗi xảy ra"}</p>`;
            }
            chatbox.scrollTop = chatbox.scrollHeight;
        })
        .catch(err => {
            chatbox.innerHTML += `<p style="color:red;"><b>Lỗi:</b> ${err.message}</p>`;
            chatbox.scrollTop = chatbox.scrollHeight;
        });

        messageInput.value = "";
    }

    document.getElementById("sendMessage").addEventListener("click", sendMessage);
    document.getElementById("message").addEventListener("keypress", function(e) {
        if (e.key === "Enter") {
            e.preventDefault();
            sendMessage();
        }
    });
</script>

{% endblock %}
